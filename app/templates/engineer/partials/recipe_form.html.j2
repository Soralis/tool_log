{# Shared recipe form partial that can be used for both create and edit #}
<div id="{{ modal_id }}" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>{{ title }}</h2>
        <form id="{{ form_id }}">
            {% if is_edit %}
            <input type="hidden" id="editRecipeId" name="recipe_id">
            {% endif %}
            
            <label for="{{ prefix }}Line">Line:</label>
            <select id="{{ prefix }}Line" name="line_id">
                <option value="">Select Line</option>
            </select>

            <div class="workpiece-selection-mode">
                <label>Recipe Type:</label>
                <div class="radio-group">
                    <label>
                        <input type="radio" name="{{ prefix }}RecipeType" value="workpiece" checked>
                        Single Workpiece
                    </label>
                    <label>
                        <input type="radio" name="{{ prefix }}RecipeType" value="group">
                        Workpiece Group
                    </label>
                </div>
            </div>

            <div id="{{ prefix }}WorkpieceContainer">
                <label for="{{ prefix }}Workpiece">Workpiece:</label>
                <select id="{{ prefix }}Workpiece" name="workpiece_id">
                    <option value="">Select Workpiece</option>
                </select>
            </div>

            <div id="{{ prefix }}WorkpieceGroupContainer" style="display: none;">
                <label for="{{ prefix }}WorkpieceGroup">Workpiece Group:</label>
                <select id="{{ prefix }}WorkpieceGroup" name="workpiece_group_id">
                    <option value="">Select Workpiece Group</option>
                </select>
            </div>
            
            <label for="{{ prefix }}Description">Description:</label>
            <textarea id="{{ prefix }}Description" name="description"></textarea>

            <label for="{{ prefix }}CycleTime">Cycle Time (seconds):</label>
            <input type="number" id="{{ prefix }}CycleTime" name="cycle_time" min="1">

            <label for="{{ prefix }}Machine">Machine:</label>
            <select id="{{ prefix }}Machine" name="machine_id" required>
                <option value="">Select Machine</option>
            </select>
            
            <h3>Tool Positions</h3>
            <div id="{{ prefix }}ToolPositionsContainer">
                <div id="{{ prefix }}ToolPositionGroups"></div>
                <div class="tool-position-controls">
                    <button type="button" class="btn-add-new" id="{{ prefix }}AddToolPositionBtn" {% if user.role < 4 %}style="display: none;"{% endif %}>Add New Position</button>
                </div>
            </div>
            
            <button type="submit" class="btn-submit">{{ submit_text }}</button>
        </form>
    </div>
</div>

<style>
.tool-position-group {
    margin: 20px 0;
    padding: 15px;
    border: 1px solid #444;
    border-radius: 4px;
    background-color: #2a2a2a;
}

.tool-position-group h4 {
    margin-top: 0;
    margin-bottom: 15px;
    color: #fff;
}

.tool-position-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
}

.tool-select {
    flex-grow: 1;
    padding: 8px;
    background-color: #333;
    color: #fff;
    border: 1px solid #444;
    border-radius: 4px;
}

.tool-select option {
    background-color: #333;
    color: #fff;
}

.btn-add-new {
    background-color: #2c5282;
    color: #fff;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
}

.btn-add-new:hover {
    background-color: #2b6cb0;
}

.btn-edit {
    background-color: #2c5282;
    color: #fff;
    border: none;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
}

.btn-edit:hover {
    background-color: #2b6cb0;
}

.btn-delete {
    background-color: #9b2c2c;
    color: #fff;
    border: none;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
}

.btn-delete:hover {
    background-color: #c53030;
}

.tool-details {
    margin-top: 10px;
    padding: 10px;
    background-color: #333;
    border-radius: 4px;
    color: #fff;
}

.tool-attribute {
    margin: 5px 0;
    color: #cbd5e0;
}

.tool-position-controls {
    margin: 20px 0;
    display: flex;
    gap: 10px;
}

.separator {
    color: #444;
    margin: 10px 0;
}

.error {
    color: #fc8181;
    font-style: italic;
}

.modal {
    background-color: rgba(0, 0, 0, 0.75);
}

.modal-content {
    background-color: #1a1a1a;
    color: #fff;
}

.modal input,
.modal textarea,
.modal select {
    background-color: #333;
    color: #fff;
    border: 1px solid #444;
}

.modal input:focus,
.modal textarea:focus,
.modal select:focus {
    border-color: #2b6cb0;
    outline: none;
}

.btn-submit {
    background-color: #2c5282;
    color: #fff;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
}

.btn-submit:hover {
    background-color: #2b6cb0;
}

.close {
    color: #fff;
}

.close:hover {
    color: #cbd5e0;
}

.hidden {
    display: none;
}

.workpiece-selection-mode {
    margin: 15px 0;
}

.radio-group {
    display: flex;
    gap: 20px;
    margin-top: 8px;
}

.radio-group label {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    color: #cbd5e0;
}

.radio-group input[type="radio"] {
    cursor: pointer;
    width: 18px;
    height: 18px;
}
</style>

<script>
    // Pass user role to JavaScript
    window.userRole = {{ user.role }};
</script>
